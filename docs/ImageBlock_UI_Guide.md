# å›¾ç‰‡å—é…ç½®ç•Œé¢ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

å½“æ‚¨åœ¨è‡ªå®šä¹‰æ•°æ®å—é…ç½®ä¸­æ·»åŠ  `image_block` ç±»å‹æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ˜¾ç¤ºä¸€ä¸ªç‹¬ç«‹çš„é…ç½®åŒºåŸŸï¼Œç”¨äºç®¡ç†éšå›¾ç‰‡ä¸€èµ·å‘é€çš„æ•°æ®å­—æ®µã€‚

## ä½¿ç”¨æ­¥éª¤

### 1. æ·»åŠ å›¾ç‰‡å—å­—æ®µ

åœ¨"æ·»åŠ æ•°æ®å­—æ®µ"åŒºåŸŸï¼š
1. è¾“å…¥å­—æ®µåç§°ï¼ˆå¦‚ï¼š`camera_image`ï¼‰
2. é€‰æ‹©ç±»å‹ä¸º **"å›¾ç‰‡å—åè®® (131Bå®šé•¿å¸§)"**
3. ç‚¹å‡»"æ·»åŠ "æŒ‰é’®

æ­¤æ—¶ä¼šå‡ºç°ä¸€ä¸ªç´«è‰²æ¸å˜çš„**å›¾ç‰‡å—æ•°æ®é…ç½®åŒºåŸŸ**ã€‚

### 2. é…ç½®éšå›¾ç‰‡å‘é€çš„æ•°æ®

å›¾ç‰‡å—å ç”¨ 131 å­—èŠ‚ï¼Œå‰©ä½™ **19 å­—èŠ‚** (150 - 131) å¯ç”¨äºæºå¸¦å…¶ä»–æ•°æ®ã€‚

#### æ–¹å¼Aï¼šä»å·²æœ‰å­—æ®µé€‰æ‹©

å¦‚æœæ‚¨å·²ç»åˆ›å»ºäº†å…¶ä»–æ•°æ®å­—æ®µï¼ˆå¦‚æ¸©åº¦ã€é€Ÿåº¦ç­‰ï¼‰ï¼Œå¯ä»¥ç›´æ¥é€‰æ‹©ï¼š

```
ğŸ“‹ ä»å·²æœ‰å­—æ®µé€‰æ‹©ï¼š
[â• temperature (4B)] [â• speed (4B)] [â• status (1B)]
```

ç‚¹å‡»ç›¸åº”æŒ‰é’®å³å¯å°†å­—æ®µæ·»åŠ åˆ°å›¾ç‰‡ä¼´éšæ•°æ®ä¸­ã€‚

#### æ–¹å¼Bï¼šæ–°å»ºä¸“ç”¨å­—æ®µ

å¦‚æœéœ€è¦åˆ›å»ºä»…ç”¨äºå›¾ç‰‡ä¼ è¾“çš„æ•°æ®å­—æ®µï¼š

1. **è¾“å…¥å­—æ®µåç§°**ï¼šå¦‚ `capture_time`
2. **é€‰æ‹©ç±»å‹**ï¼šå¦‚ `uint32 (4B)`
3. **è®¾ç½®èŒƒå›´**ï¼ˆå¯é€‰ï¼‰ï¼šæœ€å°å€¼ã€æœ€å¤§å€¼
4. **ç‚¹å‡»æ·»åŠ **

æ–°å»ºçš„å­—æ®µä¼šåŒæ—¶æ·»åŠ åˆ°ï¼š
- âœ… å›¾ç‰‡ä¼´éšæ•°æ®åˆ—è¡¨
- âœ… ä¸»æ•°æ®å­—æ®µåˆ—è¡¨

### 3. ç®¡ç†å·²é€‰å­—æ®µ

åœ¨"âœ… å·²é€‰å­—æ®µ"åŒºåŸŸå¯ä»¥çœ‹åˆ°ï¼š
- å­—æ®µåç§°å’Œç±»å‹
- å ç”¨å­—èŠ‚æ•°
- å½“å‰æ€»ä½¿ç”¨é‡ / å¯ç”¨ç©ºé—´

ç‚¹å‡»"ç§»é™¤"æŒ‰é’®å¯ä»¥ä»å›¾ç‰‡ä¼´éšæ•°æ®ä¸­åˆ é™¤å­—æ®µï¼ˆä¸å½±å“ä¸»åˆ—è¡¨ï¼‰ã€‚

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå›¾ç‰‡ + åŸºç¡€ä¼ æ„Ÿå™¨æ•°æ®

```
é…ç½®ï¼š
- camera_image (image_block, 131B)
  â””â”€ ä¼´éšæ•°æ®ï¼š
     - temperature (float, 4B)
     - battery_level (uint8, 1B)
     
æ€»è®¡ï¼š136 / 150 å­—èŠ‚
```

**å•ç‰‡æœºå‘é€ä»£ç ï¼š**
```c
// æœ‰å›¾ç‰‡æ—¶
CustomData_t data = {0};
data.temperature = 36.5;
data.battery_level = 85;
ImageBlock_Pack(&data.camera_image, img_id, block_idx, ...);
CustomData_Write(&data);
uint8_t *frame = CustomData_PackWithImage(seq);
send_uart(frame, CustomData_GetFrameSize());

// æ— å›¾ç‰‡æ—¶
CustomData_t data = {0};
data.temperature = 36.5;
data.battery_level = 85;
// camera_image ä¸å¡«å……
CustomData_Write(&data);
uint8_t *frame = CustomData_PackWithoutImage(seq);
send_uart(frame, CustomData_GetFrameSize());
```

### ç¤ºä¾‹2ï¼šå›¾ç‰‡ + æ—¶é—´æˆ³ + çŠ¶æ€

```
é…ç½®ï¼š
- image_data (image_block, 131B)
  â””â”€ ä¼´éšæ•°æ®ï¼š
     - timestamp (uint32, 4B)
     - frame_id (uint16, 2B)
     - quality (uint8, 1B)
     - is_keyframe (bool, 1B)
     
æ€»è®¡ï¼š139 / 150 å­—èŠ‚
```

## ç©ºé—´é™åˆ¶æç¤º

ç³»ç»Ÿä¼šå®æ—¶æ˜¾ç¤ºå‰©ä½™å¯ç”¨ç©ºé—´ï¼š

```
ğŸ“· å›¾ç‰‡å—æ•°æ®é…ç½® (131å­—èŠ‚)  [å‰©ä½™å¯ç”¨: 11 å­—èŠ‚]
```

- âœ… **ç»¿è‰²**ï¼šç©ºé—´å……è¶³ (< 15 å­—èŠ‚å·²ç”¨)
- âš ï¸ **é»„è‰²**ï¼šç©ºé—´ç´§å¼  (15-19 å­—èŠ‚å·²ç”¨)
- âŒ **çº¢è‰²**ï¼šæ— å‰©ä½™ç©ºé—´ (19 å­—èŠ‚å·²æ»¡)

å½“å°è¯•æ·»åŠ å­—æ®µå¯¼è‡´è¶…å‡ºé™åˆ¶æ—¶ï¼Œä¼šå¼¹å‡ºè­¦å‘Šã€‚

## æŠ€æœ¯è¯´æ˜

### æ•°æ®åˆ†ç¦»å‘é€æœºåˆ¶

1. **æœ‰å›¾ç‰‡æ¨¡å¼**ï¼šè°ƒç”¨ `CustomData_PackWithImage()`
   - æ‰“åŒ… ImageBlock + ä¼´éšæ•°æ®
   - æ€»å¤§å°ï¼š150 å­—èŠ‚

2. **æ— å›¾ç‰‡æ¨¡å¼**ï¼šè°ƒç”¨ `CustomData_PackWithoutImage()`
   - ä»…æ‰“åŒ…ä¼´éšæ•°æ®
   - ImageBlock ä½ç½®å¡«0
   - æ€»å¤§å°ï¼š150 å­—èŠ‚

### Protoå®šä¹‰å…¼å®¹æ€§

ç”Ÿæˆçš„Protoæ–‡ä»¶åŒ…å«å®Œæ•´å®šä¹‰ï¼š

```protobuf
message CustomByteBlock {
    float temperature = 1;
    uint32 battery_level = 2;
    ImageBlock camera_image = 3;  // å¯é€‰å­—æ®µ
    bytes _padding = 4;
}
```

å®¢æˆ·ç«¯ä½¿ç”¨Protobufçš„åŠ¨æ€è§£æç‰¹æ€§ï¼š
- æœ‰æ•°æ®æ—¶ï¼šæ­£å¸¸è§£æImageBlock
- æ— æ•°æ®æ—¶ï¼ˆå…¨0ï¼‰ï¼šè§†ä¸ºæœªè®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼

## å¸¸è§é—®é¢˜

**Q: å¦‚æœä¸é€‰æ‹©ä»»ä½•ä¼´éšæ•°æ®ï¼Œåªæœ‰å›¾ç‰‡å—å¯ä»¥å—ï¼Ÿ**  
A: å¯ä»¥ã€‚å›¾ç‰‡å—å 131å­—èŠ‚ï¼Œå‰©ä½™19å­—èŠ‚ä¼šè‡ªåŠ¨å¡«å……ä¸º0ã€‚

**Q: ä¼´éšæ•°æ®å­—æ®µå¯ä»¥è¶…è¿‡19å­—èŠ‚å—ï¼Ÿ**  
A: ä¸å¯ä»¥ã€‚ç³»ç»Ÿä¼šå¼ºåˆ¶é™åˆ¶åœ¨ 150 - 131 = 19 å­—èŠ‚ä»¥å†…ã€‚

**Q: åˆ é™¤ä¸»åˆ—è¡¨ä¸­çš„å­—æ®µï¼Œä¼šå½±å“å›¾ç‰‡ä¼´éšæ•°æ®å—ï¼Ÿ**  
A: ä¸ä¼šç›´æ¥åˆ é™¤ï¼Œä½†å»ºè®®ä¿æŒä¸€è‡´æ€§ã€‚ä»ä¸»åˆ—è¡¨åˆ é™¤åï¼Œè¯¥å­—æ®µä¸ä¼šå†å‡ºç°åœ¨"å¯é€‰å­—æ®µ"ä¸­ã€‚

**Q: ä¸ºä»€ä¹ˆæ–°å»ºçš„å›¾ç‰‡ä¸“ç”¨å­—æ®µä¼šåŒæ—¶å‡ºç°åœ¨ä¸»åˆ—è¡¨ï¼Ÿ**  
A: ä¸ºäº†ä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œæ‰€æœ‰å­—æ®µéƒ½ç»Ÿä¸€ç®¡ç†ã€‚æ‚¨å¯ä»¥ç†è§£ä¸º"å›¾ç‰‡ä¼´éšæ•°æ®"æ˜¯ä¸»åˆ—è¡¨çš„ä¸€ä¸ªå­é›†ã€‚

**Q: å¯ä»¥æ·»åŠ å¤šä¸ªimage_blockå—ï¼Ÿ**  
A: å¯ä»¥ï¼Œä½†æ¯ä¸ªéƒ½å 131å­—èŠ‚ã€‚ä¸¤ä¸ªimage_blockå°±æ˜¯262å­—èŠ‚ï¼Œè¶…è¿‡150å­—èŠ‚é™åˆ¶ï¼Œä¸æ¨èã€‚å»ºè®®åªä½¿ç”¨ä¸€ä¸ªimage_blockã€‚

## æœ€ä½³å®è·µ

1. **ä¼ æ„Ÿå™¨æ•°æ®ä¼˜å…ˆ**ï¼šæ¸©åº¦ã€é€Ÿåº¦ã€å§¿æ€ç­‰å®æ—¶æ•°æ®é€‚åˆä½œä¸ºä¼´éšæ•°æ®
2. **æ—¶é—´æˆ³å¿…å¤‡**ï¼šå»ºè®®å§‹ç»ˆåŒ…å«æ—¶é—´æˆ³å­—æ®µï¼Œä¾¿äºå›¾ç‰‡ä¸æ•°æ®åŒæ­¥
3. **æ§åˆ¶å­—æ®µæ•°é‡**ï¼šè™½ç„¶æœ‰19å­—èŠ‚ç©ºé—´ï¼Œä½†å»ºè®®ä½¿ç”¨4-8å­—èŠ‚ï¼Œç•™å‡ºä½™é‡
4. **ç±»å‹é€‰æ‹©**ï¼šä¼˜å…ˆä½¿ç”¨å°ç±»å‹ï¼ˆuint8, uint16ï¼‰èŠ‚çœç©ºé—´

## ç•Œé¢æˆªå›¾è¯´æ˜

### æ­£å¸¸çŠ¶æ€
```
ğŸ“· å›¾ç‰‡å—æ•°æ®é…ç½® (131å­—èŠ‚) [å‰©ä½™å¯ç”¨: 15 å­—èŠ‚]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”§ éšå›¾ç‰‡å‘é€çš„æ•°æ®å­—æ®µé…ç½®

ğŸ“‹ ä»å·²æœ‰å­—æ®µé€‰æ‹©ï¼š
[â• temperature (4B)] [â• speed (2B)]

â• æ–°å»ºä¸“ç”¨å­—æ®µï¼š
[å­—æ®µåç§°] [ç±»å‹é€‰æ‹©] [æ·»åŠ ]

âœ… å·²é€‰å­—æ®µ (4 / 19 å­—èŠ‚)ï¼š
â€¢ temperature | float (4B) | [ç§»é™¤]
```

### ç©ºé—´ä¸è¶³è­¦å‘Š
```
âŒ ç©ºé—´ä¸è¶³ï¼æ·»åŠ æ­¤å­—æ®µåå°†è¶…è¿‡å¯ç”¨ç©ºé—´ (19 å­—èŠ‚)
```
